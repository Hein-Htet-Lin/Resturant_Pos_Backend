generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       Int      @id @default(autoincrement())
  username String   @unique
  password String
  orders   Order[]
  role     Role     @default(WAITER) // WAITER, CASHIER, KITCHEN, ADMIN
}

enum Role {
  WAITER
  CASHIER
  KITCHEN
  ADMIN
}


model Category {
  id       Int       @id @default(autoincrement())
  name     String
  products Product[]
}


model Product {
  id          Int         @id @default(autoincrement())
  name        String
  price       Float
  categoryId  Int
  category    Category    @relation(fields: [categoryId], references: [id])
  orderItems  OrderItem[]
}


model Table {
  id     Int      @id @default(autoincrement())
  tableNumber String   @unique
  status TableStatus   @default(AVAILABLE)
  capacity    Int      @default(4)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders Order[]
}


model Order {
  id          Int         @id @default(autoincrement())
  tableId     Int
  table       Table       @relation(fields: [tableId], references: [id])
  userId      Int         
  user        User        @relation(fields: [userId], references: [id])
  status      OrderStatus      @default(OPEN)
  totalAmount Float       @default(0)
  items       OrderItem[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}


model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  notes     String?
  itemStatus ItemStatus   @default(PENDING)
}


enum OrderStatus {
  OPEN      
  PAID      
  CANCELLED 
}

enum ItemStatus {
  PENDING   
  COOKING   
  READY     
  SERVED    
}

enum TableStatus {
  AVAILABLE 
  OCCUPIED  
  RESERVED  
  CLEANING  
}